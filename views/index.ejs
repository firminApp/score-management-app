<!DOCTYPE html>
<html>

<head>
  <title>Score management</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
  <link rel="stylesheet" href="/css/style.css" type="css" />
  <style>
    .stranparent_bg {
      background: rgba(76, 175, 80, 0.3)
        /* Green background with 30% opacity */

    }

    .circle {
      border: 2px solid red;
      background-color: #FFFFFF;
      height: 100px;
      border-radius: 50%;
      width: 100px;
    }
  </style>
</head>

<body class="bg-success" style="background-image: url(assets/images/scor_back.jpg);">

  <h1 class="display-3 text-white text-center">Score management</h1>
  <div class="row">
    <div class="card col-2 m-1 stranparent_bg text-white">
      <h1>Teams</h1>
      <table class=" table table-light stranparent_bg text-white">
        <% teams.forEach(function(team){ %>
          <tr>
            <td>
              <%= team.name %>
            </td>
          </tr>
          <% }); %>
      </table>
    </div>

    <div class="card col-6 m-2 stranparent_bg">
      <h1 class="text-white">Leaderboard</h1>
      <table class=" table table-dark stranparent_bg text-white">
        <thead>
          <th>NÂ°</th>
          <th>Team</th>
          <th>PG</th>
          <th>V</th>
          <th>N</th>
          <th>D</th>
          <th>Pts</th>
        </thead>
        <tbody>

          <% leaderbord.forEach(function(mark,i){ %>
            <tr>
              <td > <span class="badge badge-danger"><%= ++i %></span></td>
              <td><%= mark.name %></td>
              <td><%= mark.played_match %></td>
              <td><%= mark.win %></td>
              <td><%= mark.null %></td>
              <td><%= mark.losed %></td>
              <td><%= mark.marks %></td>
            </tr>
            <% }); %>
        </tbody>

      </table>
      
    </div>

    <div class="card col-2 m-1 stranparent_bg text-white">
      <h1 class="text-white">Recent Games</h1>
      <button type="button" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#add_score_modal" id="add_score_btn">New score</button>
      <table class=" table table-light stranparent_bg text-white">
        <% games.forEach(function(game){ %>
          <tr>
            <td>
              <%= game.team_1 && game.team_2?  game.team_1.name+ " "+ game.score_team_1+ " -"+ game.score_team_2+" "+ game.team_2.name:""%>
            </td>
          </tr>
          <% }); %>
      </table>
    </div>
  </div>

  
  <div class="modal fade add_game_modal" id="add_score_modal" tabindex="-1" role="dialog" aria-labelledby="smallModalHead" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">New Score</h5>
        </div>
        <div class="form " id="add_score_form">
          <form action="/games/store" method="POST" enctype="multipart/form-data">
            <div class="form-row">
            <div class="row col-12 m-2">
              <div class="input-group mb-3 col-6">
                <div class="input-group-prepend">
                  <select class="input-group-select" name="team_1_id" id="" required>
                    <option>Select team 1...</option>
                    <% teams.forEach(function(team){ %>
                      <option value="<%=team._id %>">
                         <%= team.name %>
                     </option>
                     <% }); %>
                  </select>
                </div>
                <input type="text" name="team_1_score" required class="form-control" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default">
              </div>
              <div class="input-group mb-3 col-6">
                <input type="text"  name="team_2_score" required class="form-control"  aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default">
                <div class="input-group-prepend">
                  <select class="input-group-select" name="team_2_id" id="" required>
                    <option>Select team 2...</option>
                    <% teams.forEach(function(team){ %>
                       <option value="<%=team._id %>">
                          <%= team.name %>
                      </option>
                      <% }); %>
                  </select>
                </div>
              </div>

            </div>
            <div class="modal-footer row col-12">
              <button class="btn btn-default btn-sm" type="submit" data-dismiss="modal">Cancel</button>
              <button class="btn btn-primary btn-sm" type="submit">Save</button>
            </div>
          </form>
       </div>
      </div>
    </div>
  </div>
</body>

<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct" crossorigin="anonymous"></script>
<script src="/socket.io/socket.io.js"></script>
<script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
<script>
  var socket = io();
  socket.on("leaderbord", function(data){
    console.log("data",data)
  })
  socket.on('connection', (socket) => {
    updateLeaderBoard();
  socket.emit('new_score', (msg) => {
    console.log('message: ' + msg);
      });
    });
socket.on('new_scrore', (socket) => {
  socket.broadcast.emit('hi');
});
socket.emit('new_score', {test:"tes"});

function updateLeaderBoard(){
  $.ajax('/update_leaderboard', {
    type: 'GET',  // http method
    success: function (data, status, xhr) {
        console.log("data",data)
    },
    error: function (jqXhr, textStatus, errorMessage) {
      console.log("data",errorMessage)
    }

});
}

</script>

</html>